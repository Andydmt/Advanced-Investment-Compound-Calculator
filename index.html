<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Compound Interest Calculator • Andy Smart Investing</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Chart.js 4 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <style>
    :root{--bg:#0b0d10;--card:#12161b;--muted:#9aa4b2;--text:#e8edf2;--primary:#4da3ff;--accent:#ffd166;--muteline:#6c7a89;--success:#2dd4bf;--border:#1e242c}
    body{background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    .navbar{background:rgba(18,22,27,.7);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .brand{font-weight:700;letter-spacing:.2px;color:#fff!important}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--border);border-radius:14px}
    .form-label{color:var(--text);font-weight:600}
    .form-control,.form-range{background:#0f1318;color:var(--text);border:1px solid var(--border)}
    .form-control:focus{box-shadow:0 0 0 .2rem rgba(77,163,255,.1);border-color:#316fb7}
    .btn-primary{background:var(--primary);border-color:var(--primary)}
    .btn-outline-secondary{color:var(--muted);border-color:var(--border)}
    .btn-outline-secondary.active{color:#111;background:var(--success);border-color:var(--success)}
    .metric{display:grid;gap:.2rem}
    .metric .label{color:var(--muted);font-size:.85rem}
    .metric .value{font-size:1.25rem;font-weight:700;color:#fff}
    .chart-wrap{position:relative;height:460px}
    .taper-wrap{position:relative;height:160px}
    .toolbar{display:flex;gap:.5rem;flex-wrap:wrap}
    .table thead th{position:sticky;top:0;background:#0f1318;z-index:1}
    .footer{color:var(--muted)}
    .yt{background:#ff0033;border:none}
    .yt:hover{background:#e0002e}
    .disclaimer{font-size:.9rem;color:var(--muted)}
    a,a:hover{color:var(--primary)}
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg sticky-top">
    <div class="container-fluid">
      <span class="navbar-brand brand">Andy Smart Investing</span>
      <div class="ms-auto d-flex align-items-center gap-2">
        <a class="btn btn-sm yt text-white" target="_blank" rel="noreferrer" href="https://www.youtube.com/@AndySmartInvesting"><i class="bi bi-youtube"></i> Subscribe</a>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <div class="row g-4">
      <div class="col-12 col-xl-5">
        <div class="card p-3 p-md-4 h-100">
          <h1 class="h4 mb-2" style="color:var(--text)">Compound Interest Calculator</h1>
          <p class="disclaimer mb-3">Projections are illustrative, not advice. Rates are annual. Contributions are monthly.</p>

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label for="initialAmount" class="form-label">Initial investment</label>
              <div class="input-group"><span class="input-group-text">£</span><input type="number" id="initialAmount" class="form-control" value="1000" min="0" step="0.01"/></div>
            </div>
            <div class="col-12 col-md-6">
              <label for="monthlyContribution" class="form-label">Monthly contribution</label>
              <div class="input-group"><span class="input-group-text">£</span><input type="number" id="monthlyContribution" class="form-control" value="100" min="0" step="0.01"/></div>
            </div>

            <div class="col-12 col-md-4">
              <label class="form-label" for="startInterest">Interest start (%)</label>
              <input type="range" id="startInterest" class="form-range" min="0" max="20" step="0.1" value="2"/>
              <div class="input-group input-group-sm mt-1"><input type="number" id="startInterestInput" class="form-control" min="0" max="20" step="0.1" value="2.0"/><span class="input-group-text">%</span></div>
            </div>
            <div class="col-12 col-md-4">
              <label class="form-label" for="endInterest">Interest end (%)</label>
              <input type="range" id="endInterest" class="form-range" min="0" max="20" step="0.1" value="2"/>
              <div class="input-group input-group-sm mt-1"><input type="number" id="endInterestInput" class="form-control" min="0" max="20" step="0.1" value="2.0"/><span class="input-group-text">%</span></div>
            </div>
            <div class="col-12 col-md-4">
              <label for="years" class="form-label">Years</label>
              <input type="number" id="years" class="form-control" value="15" min="1" max="60"/>
            </div>

            <div class="col-12">
              <label class="form-label" style="color:var(--text)">Taper profile</label>
              <div class="mb-2" style="font-size:1rem;color:var(--text)">Shows how the annual rate moves from start to end over time.</div>
              <div class="btn-group mb-2" role="group">
                <button type="button" class="btn btn-outline-secondary" id="preset-linear">Straight</button>
                <button type="button" class="btn btn-outline-secondary" id="preset-early">Fast taper</button>
                <button type="button" class="btn btn-outline-secondary" id="preset-late">Slow taper</button>
              </div>
              <div class="taper-wrap"><canvas id="taperChart" aria-label="Taper preview" role="img"></canvas></div>
            </div>

            <div class="col-12 col-md-6">
              <label for="inflationRate" class="form-label">Inflation rate (%)</label>
              <input type="number" id="inflationRate" class="form-control" value="2.83" step="0.01" min="0"/>
            </div>
            <div class="col-12 col-md-6">
              <label for="ongoingCharge" class="form-label">Ongoing charge (%)</label>
              <input type="number" id="ongoingCharge" class="form-control" value="0" step="0.01" min="0"/>
            </div>
          </div>

          <div class="d-grid gap-2 mt-3">
            <button type="button" class="btn btn-primary" id="calcBtn"><i class="bi bi-calculator"></i> Calculate</button>
            <div class="toolbar">
              <button type="button" class="btn btn-outline-secondary btn-sm" id="toggleTable"><i class="bi bi-table"></i> Toggle table</button>
              <button type="button" class="btn btn-outline-secondary btn-sm" id="fullscreenBtn"><i class="bi bi-arrows-fullscreen"></i> Full screen chart</button>
              <button type="button" class="btn btn-outline-secondary btn-sm" id="downloadPng"><i class="bi bi-image"></i> Download chart</button>
              <button type="button" class="btn btn-outline-secondary btn-sm" id="downloadCsv"><i class="bi bi-filetype-csv"></i> Download CSV</button>
            </div>
          </div>

          <div class="row row-cols-2 row-cols-md-4 g-3 mt-3">
            <div class="col"><div class="metric"><span class="label">Gross Total</span><span class="value" id="finalGross">£0</span></div></div>
            <div class="col"><div class="metric"><span class="label">Total Inflation Adjusted</span><span class="value" id="finalInfl">£0</span></div></div>
            <div class="col"><div class="metric"><span class="label">Total Contributed</span><span class="value" id="totalContrib">£0</span></div></div>
            <div class="col"><div class="metric"><span class="label">Total Growth</span><span class="value" id="totalGrowth">£0</span></div></div>
          </div>

        </div>
      </div>

      <div class="col-12 col-xl-7">
        <div class="card p-3 p-md-4">
          <div class="chart-wrap"><canvas id="investmentChart" aria-label="Investment chart" role="img"></canvas></div>
          <div class="mt-3">
            <div class="table-responsive" id="tableContainer" style="display:none;max-height:360px;">
              <table class="table table-sm table-striped align-middle mb-0" id="resultsTable">
                <thead><tr><th>Year</th><th>Contribution</th><th>Growth</th><th>Gross</th><th>Infl adj</th></tr></thead>
                <tbody id="resultsTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center footer mt-4">
      <p class="mb-1">Enjoying this tool? Subscribe for more investing tools and breakdowns.</p>
      <a class="btn yt text-white" target="_blank" rel="noreferrer" href="https://www.youtube.com/@AndySmartInvesting"><i class="bi bi-youtube"></i> Subscribe on YouTube</a>
    </div>
  </main>

  <script>
    // Elements
    const startSlider = document.getElementById('startInterest');
    const endSlider = document.getElementById('endInterest');
    const startInput = document.getElementById('startInterestInput');
    const endInput = document.getElementById('endInterestInput');
    const yearsInput = document.getElementById('years');
    const initInput = document.getElementById('initialAmount');
    const contribInput = document.getElementById('monthlyContribution');
    const inflInput = document.getElementById('inflationRate');
    const feeInput = document.getElementById('ongoingCharge');

    const finalGrossEl = document.getElementById('finalGross');
    const finalInflEl = document.getElementById('finalInfl');
    const totalContribEl = document.getElementById('totalContrib');
    const totalGrowthEl = document.getElementById('totalGrowth');

    const toggleTableBtn = document.getElementById('toggleTable');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const downloadPngBtn = document.getElementById('downloadPng');
    const downloadCsvBtn = document.getElementById('downloadCsv');
    const tableContainer = document.getElementById('tableContainer');

    const chartCtx = document.getElementById('investmentChart').getContext('2d');
    const taperCtx = document.getElementById('taperChart').getContext('2d');

    let taper = 'linear';
    let chart;
    let taperChart;

    const fmtGBP0 = new Intl.NumberFormat('en-GB', { style:'currency', currency:'GBP', maximumFractionDigits:0 });

    // Theme colours
    const styles = getComputedStyle(document.documentElement);
    const COL_TOTAL = styles.getPropertyValue('--primary').trim();
    const COL_INFL  = styles.getPropertyValue('--accent').trim();
    const COL_CONTR = styles.getPropertyValue('--muteline').trim();
    const COL_TAPER = styles.getPropertyValue('--success').trim();

    // Snap helpers
    function snap01(v){ if(isNaN(v)) return 0; v = Math.min(20, Math.max(0, v)); return Math.round(v * 10) / 10; }
    function syncFromSlider(){ startInput.value = snap01(+startSlider.value).toFixed(1); endInput.value = snap01(+endSlider.value).toFixed(1); drawTaper(); }
    function syncFromInput(){ startSlider.value = snap01(+startInput.value).toFixed(1); endSlider.value = snap01(+endInput.value).toFixed(1); drawTaper(); }

    function ratesFor(type = taper){
      const yrs = Math.max(1, +yearsInput.value);
      const s = snap01(+startSlider.value)/100;
      const e = snap01(+endSlider.value)/100;
      const EPS = 1e-6;
      const out = [];
      for(let i=0;i<yrs;i++){
        const t = yrs>1 ? i/(yrs-1) : 0;
        let r;
        if(type==='linear'){ r = s + (e - s) * t; }
        else if(type==='early'){ const s2 = Math.max(s, EPS), e2 = Math.max(e, EPS); r = s2 * Math.pow(e2/s2, t); }
        else if(type==='late'){  const s2 = Math.max(s, EPS), e2 = Math.max(e, EPS); r = e2 * Math.pow(s2/e2, 1 - t); }
        else { r = s + (e - s) * t; }
        out.push(r);
      }
      return out;
    }

    function calculate(){
      syncFromSlider();
      const yrs = Math.max(1, +yearsInput.value);
      const monthly = Math.max(0, +contribInput.value);
      const infl = Math.max(0, +inflInput.value)/100;
      const fee = Math.max(0, +feeInput.value)/100;

      let gross = Math.max(0, +initInput.value);
      const contribs = [], grossArr = [], inflArr = [];
      const r = ratesFor();

      for(let i=0;i<yrs;i++){
        const annual = Math.max(-0.9999, r[i] - fee);
        const m = annual / 12;
        for(let mm=0; mm<12; mm++){ gross = gross * (1 + m) + monthly; }
        const contributed = (+initInput.value) + monthly * 12 * (i + 1);
        contribs.push(contributed);
        grossArr.push(gross);
        inflArr.push(gross / Math.pow(1 + infl, i + 1));
      }

      const finalGross = grossArr.at(-1) ?? 0;
      const finalInfl  = inflArr.at(-1) ?? 0;
      const totalContrib = contribs.at(-1) ?? (+initInput.value);
      const totalGrowth = Math.max(0, finalGross - totalContrib);

      finalGrossEl.textContent = fmtGBP0.format(finalGross);
      finalInflEl.textContent  = fmtGBP0.format(finalInfl);
      totalContribEl.textContent = fmtGBP0.format(totalContrib);
      totalGrowthEl.textContent  = fmtGBP0.format(totalGrowth);

      drawMain(contribs, grossArr, inflArr);
      renderTable(contribs, grossArr, inflArr);
    }

    function drawMain(contrib, gross, infl){
      const labels = contrib.map((_, i) => `Yr ${i+1}`);
      if(chart) chart.destroy();
      chart = new Chart(chartCtx, {
        type:'line',
        data:{ labels, datasets:[
          { label:'Capital contribution', data:contrib, tension:.25, borderColor:COL_CONTR, pointBackgroundColor:COL_CONTR },
          { label:'Total return',         data:gross,   tension:.25, borderColor:COL_TOTAL, pointBackgroundColor:COL_TOTAL },
          { label:'Inflation adjusted',   data:infl,    tension:.25, borderColor:COL_INFL,  pointBackgroundColor:COL_INFL }
        ]},
        options:{
          responsive:true, maintainAspectRatio:false,
          interaction:{ mode:'nearest', intersect:false },
          plugins:{ legend:{ labels:{ color:'#cfd6de' } },
                    tooltip:{ callbacks:{ label:c => `${c.dataset.label}: ${fmtGBP0.format(c.parsed.y)}` } } },
          scales:{
            x:{ ticks:{ color:'#9aa4b2', maxRotation:30, autoSkip:true, maxTicksLimit:12 }, grid:{ color:'rgba(255,255,255,0.05)' } },
            y:{ beginAtZero:true, ticks:{ color:'#9aa4b2', callback:v => fmtGBP0.format(v) }, grid:{ color:'rgba(255,255,255,0.05)' } }
          }
        }
      });
    }

    function drawTaper(){
      const dataPct = ratesFor(taper).map(v => v*100);
      const labels = dataPct.map((_, i) => `Y${i+1}`);
      if(taperChart) taperChart.destroy();
      taperChart = new Chart(taperCtx, {
        type:'line',
        data:{ labels, datasets:[{ label:'Rate', data:dataPct, borderColor:COL_TAPER, pointBackgroundColor:COL_TAPER, tension:.25 }] },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{ display:false } },
          scales:{ x:{ ticks:{ display:false }, grid:{ display:false } },
                   y:{ beginAtZero:true, ticks:{ color:'#9aa4b2', callback:v => `${v.toFixed(1)}%` }, grid:{ color:'rgba(255,255,255,0.05)' } } }
        }
      });
    }

    function renderTable(contribs, grossArr, inflArr){
      const tbody = document.getElementById('resultsTableBody');
      let rows = '';
      for(let i=0;i<contribs.length;i++){
        const growth = Math.max(0, grossArr[i] - contribs[i]);
        rows += `<tr><td>${i+1}</td><td>${fmtGBP0.format(contribs[i])}</td><td>${fmtGBP0.format(growth)}</td><td>${fmtGBP0.format(grossArr[i])}</td><td>${fmtGBP0.format(inflArr[i])}</td></tr>`;
      }
      tbody.innerHTML = rows;
    }

    // Event wiring
    document.getElementById('preset-linear').addEventListener('click', () => { taper='linear'; setActive(); drawTaper(); });
    document.getElementById('preset-early').addEventListener('click',  () => { taper='early';  setActive(); drawTaper(); });
    document.getElementById('preset-late').addEventListener('click',   () => { taper='late';   setActive(); drawTaper(); });
    function setActive(){ ['linear','early','late'].forEach(k => { document.getElementById('preset-'+k).classList.toggle('active', taper===k); }); }

    startSlider.addEventListener('input', syncFromSlider);
    endSlider.addEventListener('input',   syncFromSlider);
    startInput.addEventListener('input',  syncFromInput);
    endInput.addEventListener('input',    syncFromInput);
    yearsInput.addEventListener('change', drawTaper);

    document.getElementById('calcBtn').addEventListener('click', calculate);

    toggleTableBtn.onclick = () => {
      const hidden = getComputedStyle(tableContainer).display === 'none';
      tableContainer.style.display = hidden ? 'block' : 'none';
    };

    fullscreenBtn.onclick = () => {
      const wrap = document.querySelector('.chart-wrap');
      if(!document.fullscreenElement) wrap.requestFullscreen?.();
      else document.exitFullscreen?.();
    };

    downloadPngBtn.onclick = () => {
      if(!chart) return;
      const a = document.createElement('a');
      a.href = chart.toBase64Image();
      a.download = 'investment-chart.png';
      a.click();
    };

    downloadCsvBtn.onclick = () => {
      const rows = [["Year","Contribution","Growth","Gross","InflationAdjusted"]];
      document.querySelectorAll('#resultsTableBody tr').forEach(tr => {
        const cols = Array.from(tr.children).map(td =>
          td.textContent.replace(/,/g,'').replace('£','').trim()
        );
        rows.push(cols);
      });
      const csv = rows.map(r => r.join(',')).join('\n');
      const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'projection.csv';
      a.click();
      URL.revokeObjectURL(url);
    };

    // Init
    setActive();
    syncFromSlider();
    drawTaper();
    calculate();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
